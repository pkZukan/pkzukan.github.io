{{- /*  layouts/shortcodes/csv-to-markdown.html  */ -}}

{{- $src := .Get "file" | urls.Parse -}}          <!-- file= "/data/foo.csv"  or  "https://â€¦" -->
{{- $csv := slice -}}                             <!-- placeholder -->

{{- /* 1.  decide whether it is remote or local  */ -}}
{{- if $src.IsAbs -}}
  {{- with resources.GetRemote $src.String -}}
    {{- with transform.Unmarshal (dict "delimiter" ",") . -}}
      {{- $csv = . -}}
    {{- end -}}
  {{- end -}}
{{- else -}}
  {{- with resources.Get (strings.TrimPrefix "/" $src.Path) -}}
    {{- with transform.Unmarshal (dict "delimiter" ",") . -}}
      {{- $csv = . -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* 2.  render the table if we got data  */ -}}
{{- with $csv -}}
<table>
  <thead>
    <tr>
      {{- range index . 0 -}}
        <th>{{ . | htmlEscape }}</th>
      {{- end -}}
    </tr>
  </thead>
  <tbody>
    {{- range after 1 . -}}
      <tr>
        {{- range . -}}
          <td>{{ . | markdownify }}</td>
        {{- end -}}
      </tr>
    {{- end -}}
  </tbody>
</table>
{{- else -}}
  {{- errorf "shortcode csv-table: could not read CSV %q" $src -}}
{{- end -}}